(function($){Object.defineProperty(String.prototype,'sanitize',{value:function(){return this.replace(/[\s!"#$%&'()*+,.\/:;<>?@^`{|}~]/g,"\\$&");}});var APUS_WooSwatches={init:function(){$('.apus-woo-swatches:not(.apus-loop-product)').each(function(){var $apus=$(this),$form=$apus.closest('form'),$vars=$form.find('.variations'),pickerSelector='.apus-aws';$apus.on('click',pickerSelector,function(e){e.preventDefault();var $self=$(this),attribute=$self.data('attribute').sanitize(),$select=$vars.find('#'+ attribute),originalOptionSelector='option[value='+ String($self.data('term')).sanitize()+']';if(!$self.hasClass('apus-selected')){var $thisOption=$select.trigger('focusin').find(originalOptionSelector);if($thisOption.length>0){$thisOption.prop('selected',true).trigger('change');}else{$form.find('.reset_variations').trigger('click');setTimeout(function(){$select.find(originalOptionSelector).prop('selected',true).trigger('change');},250);}
$self.removeClass('apus-hidden').addClass('apus-selected').siblings('a[data-attribute='+ attribute+']').removeClass('apus-selected');}
$('body').trigger('apus-wooswatches-option-selected',[$self]);});$apus.find('select').each(function(){$(this).on('focusin',function(){var $self=$(this),$options=$vars.find('#'+ $self.data('attribute').sanitize()).trigger('focusin').find('option'),selectedOption=$self.find('option:selected').val();$self.empty().append($options.clone()).find('option:selected').prop('selected',false);if(''!==selectedOption){$self.find('option[value='+ String(selectedOption).sanitize()+']').prop('selected',true);}}).on('change',function(){var $self=$(this),$select=$vars.find('#'+ $self.data('attribute').sanitize()),selectedOption=$self.find('option:selected').val();$select.find('option:selected').prop('selected',false);if(''!==selectedOption){$form.trigger('check_variations',['',false]);$select.find('option[value='+ String(selectedOption).sanitize()+']').prop('selected',true).trigger('change');}else{$select.trigger('change');}
$('body').trigger('apus-wooswatches-option-selected',[$self]);});});});},load:function(){$('.apus-woo-swatches:not(.apus-loop-product)').each(function(){var $apus=$(this),$form=$apus.closest('form');$form.on('update_variation_values',function(e,variations){window.requestAnimationFrame(function(){APUS_WooSwatches.updateVisualAttributes($apus,variations,e);})});$form.find('.reset_variations').prependTo($apus).on('click',function(e){e.preventDefault();$apus.find('.apus-selected').removeClass('apus-selected');$apus.find('select').prop('selectedIndex',0).val('').change();$('body').trigger('apus-wooswatches-load-options-reset');}).css({'visiblity':'hidden','display':'block'});$apus.find('.apus-aws-selected').each(function(){var $self=$(this);$form.find('#'+ $self.data('attribute')).trigger('change');$self.addClass('apus-selected');});$form.trigger('check_variations');$apus.slideDown(300);});var $body=$('body');$body.trigger('apus-wooswatches-load');},updateVisualAttributes:function($apus,variations,event){var product_id=$apus.closest('form').data('product_id');var $selected=$apus.find('.apus-selected');var selected_attr=$selected.data('attribute');var selected_term=$selected.data('term');var attribs=[],dismiss=[];$apus.find('.apus-aws').addClass('apus-hidden');var filterFormElement=Array.prototype.filter.bind(event.currentTarget);var selected=filterFormElement(function(elm){return $(elm).data('attribute_name')&&!!elm.value;});if(0===selected.length){$apus.find('.apus-aws').removeClass('apus-hidden');}
selected.forEach(function(selectEl){var attribute=$(selectEl).attr('id');var attribute_name=$(selectEl).attr('name');var term=selectEl.value
$('[data-attribute="'+ attribute+'"][data-term="'+ term+'"]').removeClass('apus-hidden');var affected=variations.filter(function(variation){return variation.attributes[attribute_name]===term||variation.attributes[attribute_name]==='';});affected.forEach(function(variation){Object.keys(variation.attributes).forEach(function(curr_attr){if(variation.attributes[curr_attr]===''){$('[data-attribute='+ curr_attr.replace('attribute_','')+']').removeClass('apus-hidden')}else{$('[data-attribute='+ curr_attr.replace('attribute_','')+'][data-term='+ variation.attributes[curr_attr]+']').removeClass('apus-hidden')}});});});$('body').trigger('apus-wooswatches-options-updated',$apus.find('.apus-aws').not('.apus-hidden'));}}
$(document).ready(function(){APUS_WooSwatches.init();});$(window).load(function(){APUS_WooSwatches.load();});}(jQuery));